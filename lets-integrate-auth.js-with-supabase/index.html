<!doctype html><html lang=en><head><meta property="og:image" content="https://media2.dev.to/dynamic/image/width=1000,height=500,fit=cover,gravity=auto,format=auto/https%3A%2F%2Fdev-to-uploads.s3.amazonaws.com%2Fuploads%2Farticles%2F4girznfwedbx5fp04wue.png"><meta name=twitter:image content="https://media2.dev.to/dynamic/image/width=1000,height=500,fit=cover,gravity=auto,format=auto/https%3A%2F%2Fdev-to-uploads.s3.amazonaws.com%2Fuploads%2Farticles%2F4girznfwedbx5fp04wue.png"><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta property="og:site_name" content="My Writings - Priyanshu Verma"><meta property="og:url" content="https://priyanshuverma-dev.github.io/blogs/lets-integrate-auth.js-with-supabase/"><meta property="og:title" content="Let's integrate auth.js with Supabase!"><meta property="og:description" content="Hello everyone, Recently I was building a chat app. It was very quick to build a real-time app with supabase. I was amazed. I used this tech stack:
Next.js Auth.js (next-auth) Supabase I am not going to cover full project in this post feel free to comment for that. For now We are going to setup authentication with auth.js and supabase. So, Let&rsquo;s begain.
Step 1: Create a next.js project. There are many ways to create next.js project. I am going to use Bun. It is faster then alternatives as of now 😊.
"><meta name=twitter:card content="summary_large_image"><meta name=twitter:title content="Let's integrate auth.js with Supabase!"><meta name=twitter:description content="Hello everyone, Recently I was building a chat app. It was very quick to build a real-time app with supabase. I was amazed. I used this tech stack:
Next.js Auth.js (next-auth) Supabase I am not going to cover full project in this post feel free to comment for that. For now We are going to setup authentication with auth.js and supabase. So, Let&rsquo;s begain.
Step 1: Create a next.js project. There are many ways to create next.js project. I am going to use Bun. It is faster then alternatives as of now 😊.
"><meta name=description content="Hello everyone, Recently I was building a chat app. It was very quick to build a real-time app with supabase. I was amazed. I used this tech stack:
Next.js Auth.js (next-auth) Supabase I am not going to cover full project in this post feel free to comment for that. For now We are going to setup authentication with auth.js and supabase. So, Let&rsquo;s begain.
Step 1: Create a next.js project. There are many ways to create next.js project. I am going to use Bun. It is faster then alternatives as of now 😊.
"><title>Let's integrate auth.js with Supabase! | My Writings - Priyanshu Verma</title>
<link rel=canonical href=https://priyanshuverma-dev.github.io/blogs/lets-integrate-auth.js-with-supabase/><link rel=icon type=image/png href=/blogs/favicon.ico><link rel=stylesheet href=/blogs/bundle.min.css></head><body><div id=body-wrapper><div id=left-wrapper></div><div id=center-wrapper><div id=header><div class="main-menu pure-menu pure-menu-horizontal"><ul class=pure-menu-list><li class=pure-menu-item><a class=pure-menu-link href=https://priyanshuverma-dev.github.io/>Home</a></li><li class=pure-menu-item><a class=pure-menu-link href=/blogs/>Blog</a></li><li class=pure-menu-item><a class=pure-menu-link href=/blogs/tags/>Tags</a></li></ul><div class=translation-menu></div></div></div><div id=main><div class=post-title><h1>Let's integrate auth.js with Supabase!</h1></div><div class=post-meta><span>2024-08-05</span>
&nbsp;
<a class=post-tag href=/blogs/tags/webdev/>Webdev</a>
&nbsp;
<a class=post-tag href=/blogs/tags/supabase/>Supabase</a>
&nbsp;
<a class=post-tag href=/blogs/tags/beginners/>Beginners</a>
&nbsp;
<a class=post-tag href=/blogs/tags/nextjs/>Nextjs</a></div><div class=post-content><p>Hello everyone,
Recently I was building a chat app. It was very quick to build a real-time app with supabase. I was amazed.
I used this tech stack:</p><ul><li><a href=https://nextjs.org>Next.js</a></li><li><a href=https://authjs.dev>Auth.js</a> (next-auth)</li><li><a href=https://supabase.com>Supabase</a></li></ul><p>I am not going to cover full project in this post feel free to comment for that. For now We are going to setup authentication with auth.js and supabase. So, Let&rsquo;s begain.</p><h2 id=step-1-create-a-nextjs-project>Step 1: Create a next.js project.</h2><p>There are many ways to create next.js project. I am going to use <a href=https://bun.sh>Bun</a>. It is faster then alternatives as of now 😊.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>bun create next-app supa-auth
</span></span></code></pre></div><p>create a project by this command replace <code>supa-auth</code> with your project name. It will ask several questions chose as per your choice. I will use <strong>typescript</strong>.</p><p>You can open this project in any code editor you want I am using <a href=https://code.visualstudio.com>Vscode</a>.</p><h2 id=step-2-create-a-supabase-project>Step 2: Create a Supabase Project.</h2><p>Navigate to <a href=https://supabase.com/>Supabase Website</a>. Create an account and create a new project.</p><p><img src=https://dev-to-uploads.s3.amazonaws.com/uploads/articles/74pepxml7c3j4494akp5.png alt="Create Supabase project form"></p><p>fill project name, password, select the region that is close to you and create project.
Now you will be redirected to this screen:</p><p><img src=https://dev-to-uploads.s3.amazonaws.com/uploads/articles/q66wkgd7kqx11ct4j9zv.png alt="Supabase project dashboard"></p><p>Copy <strong>Project URL</strong> and <strong>API Key</strong> go to your project directory create a <code>.env</code> file and this fields:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-env data-lang=env><span style=display:flex><span>NEXT_PUBLIC_SUPABASE_URL<span style=color:#f92672>=</span> &lt;your project url&gt;
</span></span><span style=display:flex><span>SUPABASE_ANON_KEY<span style=color:#f92672>=</span> &lt;your project api key&gt;
</span></span></code></pre></div><h2 id=step-3-setup-authjs-with-simple-ui>Step 3: Setup auth.js with simple UI.</h2><p>Let&rsquo;s install dependencies for auth.js</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>bun add next-auth@beta @supabase/supabase-js @auth/supabase-adapter
</span></span></code></pre></div><p>These are the dependencies you need to install to setup supabase with auth.js.</p><p>After installation Setup auth.js
Create a <code>auth.ts</code> file in root of your project (if you selected <code>src</code> folder during installation then create file inside <code>src</code>).</p><p>This file will look like this:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ts data-lang=ts><span style=display:flex><span><span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>SupabaseAdapter</span> } <span style=color:#66d9ef>from</span> <span style=color:#e6db74>&#34;@auth/supabase-adapter&#34;</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> <span style=color:#a6e22e>NextAuth</span> <span style=color:#66d9ef>from</span> <span style=color:#e6db74>&#34;next-auth&#34;</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> <span style=color:#a6e22e>Google</span> <span style=color:#66d9ef>from</span> <span style=color:#e6db74>&#34;next-auth/providers/google&#34;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>export</span> <span style=color:#66d9ef>const</span> { <span style=color:#a6e22e>handlers</span>, <span style=color:#a6e22e>signIn</span>, <span style=color:#a6e22e>signOut</span>, <span style=color:#a6e22e>auth</span> } <span style=color:#f92672>=</span> <span style=color:#a6e22e>NextAuth</span>({
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>providers</span><span style=color:#f92672>:</span> [<span style=color:#a6e22e>Google</span>],
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>adapter</span>: <span style=color:#66d9ef>SupabaseAdapter</span>({
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>url</span>: <span style=color:#66d9ef>process.env.NEXT_PUBLIC_SUPABASE_URL</span> <span style=color:#66d9ef>as</span> <span style=color:#66d9ef>string</span>,
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>secret</span>: <span style=color:#66d9ef>process.env.SUPABASE_ANON_KEY</span> <span style=color:#66d9ef>as</span> <span style=color:#66d9ef>string</span>,
</span></span><span style=display:flex><span>  }),
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>debug</span>: <span style=color:#66d9ef>process.env.NODE_ENV</span> <span style=color:#f92672>===</span> <span style=color:#e6db74>&#34;development&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>session</span><span style=color:#f92672>:</span> { <span style=color:#a6e22e>strategy</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;jwt&#34;</span> },
</span></span><span style=display:flex><span>});
</span></span></code></pre></div><p>You can tweak this file as per your requirement. I am going to use Google Oauth to signin you can use others also. you can see from <a href=https://authjs.dev>auth.js docs</a>.</p><p>Add Google Client ID and Secret in <code>.env</code> file and add auth secret for auth.js like this:</p><pre tabindex=0><code>NEXT_PUBLIC_SUPABASE_URL= &lt;your project url&gt;
SUPABASE_ANON_KEY= &lt;your project api key&gt;

AUTH_SECRET=&#34;secret-for-authjs&#34; # change this

AUTH_GOOGLE_ID= &lt;your google client id&gt;
AUTH_GOOGLE_SECRET= &lt;your google client secret&gt;
</code></pre><p><strong>Remember</strong> to write variable name as given for <code>AUTH_GOOGLE_ID</code>, <code>AUTH_GOOGLE_SECRET</code> and <code>AUTH_SECRET</code>. It is required <a href=https://authjs.dev/guides/environment-variables>see more</a></p><p>You will get Google client id and secret from <a href=https://console.cloud.google.com/>Google Cloud Console</a>.</p><p>Add this to Authorised redirect URIs: <code>https://localhost:3000/api/auth/callback/google</code></p><p>Now create a <code>middlware.ts</code> file in root of your project beside <code>auth.ts</code>.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ts data-lang=ts><span style=display:flex><span><span style=color:#66d9ef>export</span> { <span style=color:#a6e22e>auth</span> <span style=color:#66d9ef>as</span> <span style=color:#a6e22e>middleware</span> } <span style=color:#66d9ef>from</span> <span style=color:#e6db74>&#34;@/auth&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>export</span> <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>config</span> <span style=color:#f92672>=</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>matcher</span><span style=color:#f92672>:</span> [<span style=color:#e6db74>&#34;/((?!.+\\.[\\w]+$|_next).*)&#34;</span>, <span style=color:#e6db74>&#34;/(api|trpc)(.*)&#34;</span>],
</span></span><span style=display:flex><span>};
</span></span></code></pre></div><p>Finally Add a Route Handler under <code>/app/api/auth/[...nextauth]/route.ts</code>.
Add this to the file:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ts data-lang=ts><span style=display:flex><span><span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>handlers</span> } <span style=color:#66d9ef>from</span> <span style=color:#e6db74>&#34;@/auth&#34;</span> <span style=color:#75715e>// Referring to the auth.ts we just created
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>export</span> <span style=color:#66d9ef>const</span> { <span style=color:#a6e22e>GET</span>, <span style=color:#a6e22e>POST</span> } <span style=color:#f92672>=</span> <span style=color:#a6e22e>handlers</span>
</span></span></code></pre></div><h2 id=step-4-now-create-a-signin-button-component>Step 4: Now create a signin Button component.</h2><p>create a file <code>/components/sign-in.tsx</code>.
with this content:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ts data-lang=ts><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>signIn</span> } <span style=color:#66d9ef>from</span> <span style=color:#e6db74>&#34;@/auth&#34;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span><span style=color:#66d9ef>export</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>SignIn() {</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> (
</span></span><span style=display:flex><span>    &lt;<span style=color:#f92672>form</span>
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>action</span><span style=color:#f92672>=</span>{<span style=color:#66d9ef>async</span> () <span style=color:#f92672>=&gt;</span> {
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;use server&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>await</span> <span style=color:#a6e22e>signIn</span>(<span style=color:#e6db74>&#34;google&#34;</span>)
</span></span><span style=display:flex><span>      }}
</span></span><span style=display:flex><span>    &gt;
</span></span><span style=display:flex><span>      &lt;<span style=color:#f92672>button</span> <span style=color:#a6e22e>type</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;submit&#34;</span>&gt;<span style=color:#a6e22e>Signin</span> <span style=color:#66d9ef>with</span> <span style=color:#a6e22e>Google</span>&lt;/<span style=color:#f92672>button</span>&gt;
</span></span><span style=display:flex><span>    &lt;/<span style=color:#f92672>form</span>&gt;
</span></span><span style=display:flex><span>  )
</span></span><span style=display:flex><span>} 
</span></span></code></pre></div><p>Now Just add this component to make user signin by clicking on this button.</p><h2 id=step-5-bind-supabase-db-with-authjs-important>Step 5: Bind Supabase db with auth.js (Important)</h2><p>This part is very important and crucial. So, Please give it time.</p><p>Go to your supabase project.
Click on <strong>SQL Editor</strong> looks like this:</p><p><img src=https://dev-to-uploads.s3.amazonaws.com/uploads/articles/peehezkb4y8e9zw5wzbe.png alt="Supabase SQL Editor"></p><p>Paste this into editor and run <a href=https://authjs.dev/getting-started/adapters/supabase#schema>(learn more)</a>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#75715e>--
</span></span></span><span style=display:flex><span><span style=color:#75715e>-- Name: next_auth; Type: SCHEMA;
</span></span></span><span style=display:flex><span><span style=color:#75715e>--
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>CREATE</span> <span style=color:#66d9ef>SCHEMA</span> next_auth;
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span><span style=color:#66d9ef>GRANT</span> <span style=color:#66d9ef>USAGE</span> <span style=color:#66d9ef>ON</span> <span style=color:#66d9ef>SCHEMA</span> next_auth <span style=color:#66d9ef>TO</span> service_role;
</span></span><span style=display:flex><span><span style=color:#66d9ef>GRANT</span> <span style=color:#66d9ef>ALL</span> <span style=color:#66d9ef>ON</span> <span style=color:#66d9ef>SCHEMA</span> next_auth <span style=color:#66d9ef>TO</span> postgres;
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span><span style=color:#75715e>--
</span></span></span><span style=display:flex><span><span style=color:#75715e>-- Create users table
</span></span></span><span style=display:flex><span><span style=color:#75715e>--
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>CREATE</span> <span style=color:#66d9ef>TABLE</span> <span style=color:#66d9ef>IF</span> <span style=color:#66d9ef>NOT</span> <span style=color:#66d9ef>EXISTS</span> next_auth.users
</span></span><span style=display:flex><span>(
</span></span><span style=display:flex><span>    id uuid <span style=color:#66d9ef>NOT</span> <span style=color:#66d9ef>NULL</span> <span style=color:#66d9ef>DEFAULT</span> uuid_generate_v4(),
</span></span><span style=display:flex><span>    name text,
</span></span><span style=display:flex><span>    email text,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;emailVerified&#34;</span> <span style=color:#66d9ef>timestamp</span> <span style=color:#66d9ef>with</span> time <span style=color:#66d9ef>zone</span>,
</span></span><span style=display:flex><span>    image text,
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>CONSTRAINT</span> users_pkey <span style=color:#66d9ef>PRIMARY</span> <span style=color:#66d9ef>KEY</span> (id),
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>CONSTRAINT</span> email_unique <span style=color:#66d9ef>UNIQUE</span> (email)
</span></span><span style=display:flex><span>);
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span><span style=color:#66d9ef>GRANT</span> <span style=color:#66d9ef>ALL</span> <span style=color:#66d9ef>ON</span> <span style=color:#66d9ef>TABLE</span> next_auth.users <span style=color:#66d9ef>TO</span> postgres;
</span></span><span style=display:flex><span><span style=color:#66d9ef>GRANT</span> <span style=color:#66d9ef>ALL</span> <span style=color:#66d9ef>ON</span> <span style=color:#66d9ef>TABLE</span> next_auth.users <span style=color:#66d9ef>TO</span> service_role;
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span><span style=color:#75715e>--- uid() function to be used in RLS policies
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>CREATE</span> <span style=color:#66d9ef>FUNCTION</span> next_auth.uid() <span style=color:#66d9ef>RETURNS</span> uuid
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>LANGUAGE</span> <span style=color:#66d9ef>sql</span> <span style=color:#66d9ef>STABLE</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>AS</span> <span style=color:#960050;background-color:#1e0010>$$</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>select</span>
</span></span><span style=display:flex><span>  	coalesce(
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>nullif</span>(current_setting(<span style=color:#e6db74>&#39;request.jwt.claim.sub&#39;</span>, <span style=color:#66d9ef>true</span>), <span style=color:#e6db74>&#39;&#39;</span>),
</span></span><span style=display:flex><span>		(<span style=color:#66d9ef>nullif</span>(current_setting(<span style=color:#e6db74>&#39;request.jwt.claims&#39;</span>, <span style=color:#66d9ef>true</span>), <span style=color:#e6db74>&#39;&#39;</span>)::jsonb <span style=color:#f92672>-&gt;&gt;</span> <span style=color:#e6db74>&#39;sub&#39;</span>)
</span></span><span style=display:flex><span>	)::uuid
</span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>$$</span>;
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span><span style=color:#75715e>--
</span></span></span><span style=display:flex><span><span style=color:#75715e>-- Create sessions table
</span></span></span><span style=display:flex><span><span style=color:#75715e>--
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>CREATE</span> <span style=color:#66d9ef>TABLE</span> <span style=color:#66d9ef>IF</span> <span style=color:#66d9ef>NOT</span> <span style=color:#66d9ef>EXISTS</span>  next_auth.sessions
</span></span><span style=display:flex><span>(
</span></span><span style=display:flex><span>    id uuid <span style=color:#66d9ef>NOT</span> <span style=color:#66d9ef>NULL</span> <span style=color:#66d9ef>DEFAULT</span> uuid_generate_v4(),
</span></span><span style=display:flex><span>    expires <span style=color:#66d9ef>timestamp</span> <span style=color:#66d9ef>with</span> time <span style=color:#66d9ef>zone</span> <span style=color:#66d9ef>NOT</span> <span style=color:#66d9ef>NULL</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;sessionToken&#34;</span> text <span style=color:#66d9ef>NOT</span> <span style=color:#66d9ef>NULL</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;userId&#34;</span> uuid,
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>CONSTRAINT</span> sessions_pkey <span style=color:#66d9ef>PRIMARY</span> <span style=color:#66d9ef>KEY</span> (id),
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>CONSTRAINT</span> sessionToken_unique <span style=color:#66d9ef>UNIQUE</span> (<span style=color:#e6db74>&#34;sessionToken&#34;</span>),
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>CONSTRAINT</span> <span style=color:#e6db74>&#34;sessions_userId_fkey&#34;</span> <span style=color:#66d9ef>FOREIGN</span> <span style=color:#66d9ef>KEY</span> (<span style=color:#e6db74>&#34;userId&#34;</span>)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>REFERENCES</span>  next_auth.users (id) <span style=color:#66d9ef>MATCH</span> <span style=color:#66d9ef>SIMPLE</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>ON</span> <span style=color:#66d9ef>UPDATE</span> <span style=color:#66d9ef>NO</span> ACTION
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>ON</span> <span style=color:#66d9ef>DELETE</span> <span style=color:#66d9ef>CASCADE</span>
</span></span><span style=display:flex><span>);
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span><span style=color:#66d9ef>GRANT</span> <span style=color:#66d9ef>ALL</span> <span style=color:#66d9ef>ON</span> <span style=color:#66d9ef>TABLE</span> next_auth.sessions <span style=color:#66d9ef>TO</span> postgres;
</span></span><span style=display:flex><span><span style=color:#66d9ef>GRANT</span> <span style=color:#66d9ef>ALL</span> <span style=color:#66d9ef>ON</span> <span style=color:#66d9ef>TABLE</span> next_auth.sessions <span style=color:#66d9ef>TO</span> service_role;
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span><span style=color:#75715e>--
</span></span></span><span style=display:flex><span><span style=color:#75715e>-- Create accounts table
</span></span></span><span style=display:flex><span><span style=color:#75715e>--
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>CREATE</span> <span style=color:#66d9ef>TABLE</span> <span style=color:#66d9ef>IF</span> <span style=color:#66d9ef>NOT</span> <span style=color:#66d9ef>EXISTS</span>  next_auth.accounts
</span></span><span style=display:flex><span>(
</span></span><span style=display:flex><span>    id uuid <span style=color:#66d9ef>NOT</span> <span style=color:#66d9ef>NULL</span> <span style=color:#66d9ef>DEFAULT</span> uuid_generate_v4(),
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>type</span> text <span style=color:#66d9ef>NOT</span> <span style=color:#66d9ef>NULL</span>,
</span></span><span style=display:flex><span>    provider text <span style=color:#66d9ef>NOT</span> <span style=color:#66d9ef>NULL</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;providerAccountId&#34;</span> text <span style=color:#66d9ef>NOT</span> <span style=color:#66d9ef>NULL</span>,
</span></span><span style=display:flex><span>    refresh_token text,
</span></span><span style=display:flex><span>    access_token text,
</span></span><span style=display:flex><span>    expires_at bigint,
</span></span><span style=display:flex><span>    token_type text,
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>scope</span> text,
</span></span><span style=display:flex><span>    id_token text,
</span></span><span style=display:flex><span>    session_state text,
</span></span><span style=display:flex><span>    oauth_token_secret text,
</span></span><span style=display:flex><span>    oauth_token text,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;userId&#34;</span> uuid,
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>CONSTRAINT</span> accounts_pkey <span style=color:#66d9ef>PRIMARY</span> <span style=color:#66d9ef>KEY</span> (id),
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>CONSTRAINT</span> provider_unique <span style=color:#66d9ef>UNIQUE</span> (provider, <span style=color:#e6db74>&#34;providerAccountId&#34;</span>),
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>CONSTRAINT</span> <span style=color:#e6db74>&#34;accounts_userId_fkey&#34;</span> <span style=color:#66d9ef>FOREIGN</span> <span style=color:#66d9ef>KEY</span> (<span style=color:#e6db74>&#34;userId&#34;</span>)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>REFERENCES</span>  next_auth.users (id) <span style=color:#66d9ef>MATCH</span> <span style=color:#66d9ef>SIMPLE</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>ON</span> <span style=color:#66d9ef>UPDATE</span> <span style=color:#66d9ef>NO</span> ACTION
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>ON</span> <span style=color:#66d9ef>DELETE</span> <span style=color:#66d9ef>CASCADE</span>
</span></span><span style=display:flex><span>);
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span><span style=color:#66d9ef>GRANT</span> <span style=color:#66d9ef>ALL</span> <span style=color:#66d9ef>ON</span> <span style=color:#66d9ef>TABLE</span> next_auth.accounts <span style=color:#66d9ef>TO</span> postgres;
</span></span><span style=display:flex><span><span style=color:#66d9ef>GRANT</span> <span style=color:#66d9ef>ALL</span> <span style=color:#66d9ef>ON</span> <span style=color:#66d9ef>TABLE</span> next_auth.accounts <span style=color:#66d9ef>TO</span> service_role;
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span><span style=color:#75715e>--
</span></span></span><span style=display:flex><span><span style=color:#75715e>-- Create verification_tokens table
</span></span></span><span style=display:flex><span><span style=color:#75715e>--
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>CREATE</span> <span style=color:#66d9ef>TABLE</span> <span style=color:#66d9ef>IF</span> <span style=color:#66d9ef>NOT</span> <span style=color:#66d9ef>EXISTS</span>  next_auth.verification_tokens
</span></span><span style=display:flex><span>(
</span></span><span style=display:flex><span>    identifier text,
</span></span><span style=display:flex><span>    token text,
</span></span><span style=display:flex><span>    expires <span style=color:#66d9ef>timestamp</span> <span style=color:#66d9ef>with</span> time <span style=color:#66d9ef>zone</span> <span style=color:#66d9ef>NOT</span> <span style=color:#66d9ef>NULL</span>,
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>CONSTRAINT</span> verification_tokens_pkey <span style=color:#66d9ef>PRIMARY</span> <span style=color:#66d9ef>KEY</span> (token),
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>CONSTRAINT</span> token_unique <span style=color:#66d9ef>UNIQUE</span> (token),
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>CONSTRAINT</span> token_identifier_unique <span style=color:#66d9ef>UNIQUE</span> (token, identifier)
</span></span><span style=display:flex><span>);
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span><span style=color:#66d9ef>GRANT</span> <span style=color:#66d9ef>ALL</span> <span style=color:#66d9ef>ON</span> <span style=color:#66d9ef>TABLE</span> next_auth.verification_tokens <span style=color:#66d9ef>TO</span> postgres;
</span></span><span style=display:flex><span><span style=color:#66d9ef>GRANT</span> <span style=color:#66d9ef>ALL</span> <span style=color:#66d9ef>ON</span> <span style=color:#66d9ef>TABLE</span> next_auth.verification_tokens <span style=color:#66d9ef>TO</span> service_role;
</span></span></code></pre></div><p>After successfully execution go to your <strong>project settings</strong> inside <code>Configuration</code> click on API and scroll to <strong>Data API Settings</strong> looks like this:</p><p><img src=https://dev-to-uploads.s3.amazonaws.com/uploads/articles/vr9m64pa68k5ezr4j210.png alt="Supabase Data API Settings"></p><p>In <strong>Exposed schemas</strong> add <code>next-auth</code> like this:</p><p><img src=https://dev-to-uploads.s3.amazonaws.com/uploads/articles/sdhe5rny4jkcwd2phf8u.png alt="Exposed schemas Data API Settings"></p><p><strong>Save settings</strong>.</p><p>Step 5: Run Project
Now you can run your next.js project with</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>bun dev
</span></span></code></pre></div><p>Now visit <code>https://localhost:3000</code> it will redirect you to <code>https://localhost:3000/api/auth/signin</code>.
You can signin with Google.</p><p>Further you can add Auth Page to override this default page by editing <code>auth.ts</code>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ts data-lang=ts><span style=display:flex><span><span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>SupabaseAdapter</span> } <span style=color:#66d9ef>from</span> <span style=color:#e6db74>&#34;@auth/supabase-adapter&#34;</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> <span style=color:#a6e22e>NextAuth</span> <span style=color:#66d9ef>from</span> <span style=color:#e6db74>&#34;next-auth&#34;</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> <span style=color:#a6e22e>Google</span> <span style=color:#66d9ef>from</span> <span style=color:#e6db74>&#34;next-auth/providers/google&#34;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>export</span> <span style=color:#66d9ef>const</span> { <span style=color:#a6e22e>handlers</span>, <span style=color:#a6e22e>signIn</span>, <span style=color:#a6e22e>signOut</span>, <span style=color:#a6e22e>auth</span> } <span style=color:#f92672>=</span> <span style=color:#a6e22e>NextAuth</span>({
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>providers</span><span style=color:#f92672>:</span> [<span style=color:#a6e22e>Google</span>],
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>adapter</span>: <span style=color:#66d9ef>SupabaseAdapter</span>({
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>url</span>: <span style=color:#66d9ef>process.env.NEXT_PUBLIC_SUPABASE_URL</span> <span style=color:#66d9ef>as</span> <span style=color:#66d9ef>string</span>,
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>secret</span>: <span style=color:#66d9ef>process.env.SUPABASE_ANON_KEY</span> <span style=color:#66d9ef>as</span> <span style=color:#66d9ef>string</span>,
</span></span><span style=display:flex><span>  }),
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>debug</span>: <span style=color:#66d9ef>process.env.NODE_ENV</span> <span style=color:#f92672>===</span> <span style=color:#e6db74>&#34;development&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>session</span><span style=color:#f92672>:</span> { <span style=color:#a6e22e>strategy</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;jwt&#34;</span> },
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>pages</span><span style=color:#f92672>:</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>signIn</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;/&lt;sigin-page-url&gt;&#34;</span>,
</span></span><span style=display:flex><span>  },
</span></span><span style=display:flex><span>});
</span></span></code></pre></div><p>replace <code>&lt;sigin-page-url></code> with your auth page.</p><p>These were the easiest steps to setup supabase with auth.js. now you need to just call:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ts data-lang=ts><span style=display:flex><span> <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>session</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>await</span> <span style=color:#a6e22e>auth</span>()
</span></span></code></pre></div><p>To get user session don&rsquo;t need to create you own context and hooks.👍
For more information read official auth.js <a href=https://authjs.dev/getting-started/session-management/get-session>Docs</a></p><p>Thanks for your time.
Priyanshu Verma</p></div></div><div id=footer><span class=post-meta>&copy; Priyanshu Verma &nbsp;2024
</span>&nbsp;
<a href=/blogs/sitemap.xml title=Sitemap target=_blank>Sitemap</a> &nbsp;
<a href=https://github.com/priyanshuverma-dev title=Github target=_blank>Github</a></div></div><div id=right-wrapper></div></div><script src=https://statstream.onrender.com/scripts/tracker data-nscript=afterInteractive></script></body></html>