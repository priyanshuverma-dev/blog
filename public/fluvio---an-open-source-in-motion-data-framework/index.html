<!DOCTYPE html>
<html lang="en">
<head><script src="/blog/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=blog/livereload" data-no-instant defer></script>


<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<meta property="og:site_name" content="My Writings - Priyanshu Verma">
<meta property="og:url" content="http://localhost:1313/blog/fluvio---an-open-source-in-motion-data-framework./">
<meta property="og:title" content="Fluvio - An open-source In-motion data framework.">
<meta property="og:description" content="Hello enthusiasts,
Today we are going to learn about Fluvio work with this technology. This post is not about theory it&rsquo;s a practical based article. You can checkout Fluvio&rsquo;s own blogs to learn about fluvio deep.
Why to read this article? Yes, you can find the documentation about Fluvio in the corners of internet but you can&rsquo;t get a end-to-end project that&rsquo;s what this article provides you. Believe me at the end you will find yourself confident with fluvio and one simple yet complex project. Let&rsquo;s dive right in!
">

<meta name="description" content="Hello enthusiasts,
Today we are going to learn about Fluvio work with this technology. This post is not about theory it&rsquo;s a practical based article. You can checkout Fluvio&rsquo;s own blogs to learn about fluvio deep.
Why to read this article? Yes, you can find the documentation about Fluvio in the corners of internet but you can&rsquo;t get a end-to-end project that&rsquo;s what this article provides you. Believe me at the end you will find yourself confident with fluvio and one simple yet complex project. Let&rsquo;s dive right in!
">

<title>Fluvio - An open-source In-motion data framework. | My Writings - Priyanshu Verma</title>
<link rel="canonical" href="http://localhost:1313/blog/fluvio---an-open-source-in-motion-data-framework./">

 
 
<link rel="icon" href="data:;base64,iVBORw0KGgo=">

    
    
    
    <link rel="stylesheet" href="/blog/bundle.min.css">
</head>
<body>

<div id="body-wrapper">
    <div id="left-wrapper">
        

    </div>
    <div id="center-wrapper">
        
<div id="header">
  <div class="main-menu pure-menu pure-menu-horizontal">
    <ul class="pure-menu-list"> 
      <li
        class="pure-menu-item "
      >
        <a
          class="pure-menu-link"
          href="https://priyanshuverma-dev.github.io/"
          >Home</a>
      </li> 
      <li
        class="pure-menu-item "
      >
        <a
          class="pure-menu-link"
          href="/blog/"
          >Blog</a>
      </li> 
      <li
        class="pure-menu-item "
      >
        <a
          class="pure-menu-link"
          href="/blog/tags/"
          >Tags</a>
      </li>
    </ul>

    <div class="translation-menu">
    </div>
  </div>
</div>

        <div id="main">
            
    
<div class="post-title">
        <h1>
            Fluvio - An open-source In-motion data framework.</h1>
</div>
<div class="post-meta">
        <span>2024-08-20</span>
        &nbsp;
        
    
    <a class="post-tag" href="/blog/tags/fluvio/">Fluvio</a>
    &nbsp;
    <a class="post-tag" href="/blog/tags/beginners/">Beginners</a>
    &nbsp;
    <a class="post-tag" href="/blog/tags/programming/">Programming</a>
    &nbsp;
    <a class="post-tag" href="/blog/tags/realtimedatastream/">Realtimedatastream</a>

</div>
<div class="post-content"><p>Hello enthusiasts,</p>
<p>Today we are going to learn about <a href="https://www.fluvio.io/">Fluvio</a> work with this technology. This post is not about theory it&rsquo;s a practical based article. You can checkout Fluvio&rsquo;s own <a href="https://www.infinyon.com/blog/2021/06/introducing-fluvio/">blogs</a> to learn about fluvio deep.</p>
<h2 id="why-to-read-this-article">Why to read this article?</h2>
<p>Yes, you can find the documentation about <a href="https://www.fluvio.io/">Fluvio</a> in the corners of internet but you can&rsquo;t get a end-to-end project that&rsquo;s what this article provides you. Believe me at the end you will find yourself confident with fluvio and one simple yet complex project.
Let&rsquo;s dive right in!</p>
<h2 id="what-is-the-problem-and-the-fix">What is the Problem and the fix?</h2>
<p>The problem is to solve the Real-time data stream of the price of stocks efficiently without using complex services like Kafka, Pulsar, Flink, Spark, etc. By using a simple topic-based data stream with Fluvio.</p>
<h2 id="create-project">Create Project</h2>
<p>I am going to use the following stack:</p>
<ul>
<li>Frontend <a href="https://nextjs.org/">(Next.js)</a></li>
<li>Backend <a href="https://expressjs.com/">(Express.js)</a></li>
<li>Data Stream <a href="https://www.fluvio.io/docs/fluvio/quickstart/">(Fluvio)</a></li>
</ul>
<p>Let&rsquo;s go step-by-step</p>
<h2 id="step-1-install-fluvio">Step 1: Install fluvio</h2>
<p>Use To fluvio we need to install <a href="https://www.fluvio.io/docs/fluvio/cli/overview">Fluvio CLI</a>. We need a Docker or linux machine to install Fluvio. I will use <a href="https://learn.microsoft.com/en-us/windows/wsl/install">WSL</a>.
To install fluvio run:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>curl -fsS https://hub.infinyon.cloud/install/install.sh | bash
</span></span></code></pre></div><p>For Docker follow official fluvio <a href="https://www.fluvio.io/docs/fluvio/installation/docker">steps</a>.</p>
<p>Now you need to start the fluvio cluster</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>fluvio cluster start
</span></span></code></pre></div><p>If you need to start it a second time use this command:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>fluvio cluster resume
</span></span></code></pre></div><h2 id="step-2-set-up-project-folder-and-file-structure">Step 2: Set up project folder and file structure.</h2>
<p>Create a folder and open it in <strong>VSCode</strong> (you can use anything).</p>
<pre tabindex="0"><code>├── server/
│   ├── index.ts           # Main server code
├── client/
│   ├── components/
│   │   │
│   │   ├── StockChart.tsx  # Main chart component
│   │   └── StockSwitch.tsx  # Component for toggling stock charts
│   └── (...other files)
└── http-sources/
    ├── amzn.yml  # Example YAML file for defining HTTP sources
    └── deploy.sh          # Script for deploying and creating Fluvio 
</code></pre><p>We have create <strong>3 sub-folders</strong>:</p>
<ul>
<li>server - (express server code)</li>
<li>client - (next.js app)</li>
<li>http-sources - (fluvio configs)</li>
</ul>
<h2 id="step-3-write-server-code-to-create-apis">Step 3: Write server code to create APIS</h2>
<ul>
<li>In the created folder <code>server</code> initialize the project with:</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>bun init
</span></span></code></pre></div><p>You can use <code>npm</code> also. Using bash for type script.</p>
<ul>
<li>Install required dependencies:</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>bun add @fluvio/client cors express yahoo-finance2
</span></span></code></pre></div><p>Install types also if you are using TypeScript:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>bun add -D @types/cors @types/express
</span></span></code></pre></div><ul>
<li>Open the <code>index.ts</code> file created while initializing the project and write some code.</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-typescript" data-lang="typescript"><span style="display:flex;"><span><span style="color:#66d9ef">import</span> <span style="color:#a6e22e">yahooFinance</span> <span style="color:#66d9ef">from</span> <span style="color:#e6db74">&#34;yahoo-finance2&#34;</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">import</span> <span style="color:#a6e22e">Express</span> <span style="color:#66d9ef">from</span> <span style="color:#e6db74">&#34;express&#34;</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">import</span> <span style="color:#a6e22e">cors</span> <span style="color:#66d9ef">from</span> <span style="color:#e6db74">&#34;cors&#34;</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">import</span> <span style="color:#a6e22e">Fluvio</span>, { <span style="color:#a6e22e">Offset</span>, <span style="color:#66d9ef">type</span> <span style="color:#a6e22e">Record</span>, <span style="color:#66d9ef">type</span> <span style="color:#a6e22e">Topic</span> } <span style="color:#66d9ef">from</span> <span style="color:#e6db74">&#34;@fluvio/client&#34;</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">PORT</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">process</span>.<span style="color:#a6e22e">env</span>.<span style="color:#a6e22e">PORT</span> <span style="color:#f92672">||</span> <span style="color:#ae81ff">8080</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">PARTITION</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">fluvio</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Fluvio</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">app</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">Express</span>();
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">app</span>.<span style="color:#a6e22e">use</span>(<span style="color:#a6e22e">cors</span>());
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// To get current price of share (default to APPL) can be changed if add query `?symbol=MSFT`
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#a6e22e">app</span>.<span style="color:#66d9ef">get</span>(<span style="color:#e6db74">&#34;/price&#34;</span>, <span style="color:#66d9ef">async</span> (<span style="color:#a6e22e">req</span>, <span style="color:#a6e22e">res</span>) <span style="color:#f92672">=&gt;</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">try</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">let</span> <span style="color:#66d9ef">symbol</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">string</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">req</span>.<span style="color:#a6e22e">query</span>.<span style="color:#66d9ef">symbol</span> <span style="color:#f92672">==</span> <span style="color:#66d9ef">null</span>) {
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">symbol</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;AAPL&#34;</span>;
</span></span><span style="display:flex;"><span>    } <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">symbol</span> <span style="color:#f92672">=</span> String(<span style="color:#a6e22e">req</span>.<span style="color:#a6e22e">query</span>.<span style="color:#66d9ef">symbol</span>);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">quote</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">await</span> <span style="color:#a6e22e">yahooFinance</span>.<span style="color:#a6e22e">quote</span>(<span style="color:#66d9ef">symbol</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> { <span style="color:#a6e22e">regularMarketPrice</span> } <span style="color:#f92672">=</span> <span style="color:#a6e22e">quote</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">payload</span> <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">symbol</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">symbol</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">price</span>: <span style="color:#66d9ef">regularMarketPrice</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">time</span>: <span style="color:#66d9ef">Date.now</span>(),
</span></span><span style="display:flex;"><span>    };
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">res</span>.<span style="color:#a6e22e">json</span>(<span style="color:#a6e22e">payload</span>);
</span></span><span style="display:flex;"><span>  } <span style="color:#66d9ef">catch</span> (<span style="color:#a6e22e">error</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#a6e22e">error</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">res</span>.<span style="color:#a6e22e">status</span>(<span style="color:#ae81ff">500</span>).<span style="color:#a6e22e">json</span>({
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">error</span>: <span style="color:#66d9ef">error</span>,
</span></span><span style="display:flex;"><span>    });
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>});
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// To get stream data for client-side websites requires topic-id.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#a6e22e">app</span>.<span style="color:#66d9ef">get</span>(<span style="color:#e6db74">&#34;/stream/:topic&#34;</span>, <span style="color:#66d9ef">async</span> (<span style="color:#a6e22e">req</span>, <span style="color:#a6e22e">res</span>) <span style="color:#f92672">=&gt;</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">try</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">topic</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">req</span>.<span style="color:#a6e22e">params</span>.<span style="color:#a6e22e">topic</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">res</span>.<span style="color:#a6e22e">setHeader</span>(<span style="color:#e6db74">&#34;Access-Control-Allow-Origin&#34;</span>, <span style="color:#e6db74">&#34;*&#34;</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">res</span>.<span style="color:#a6e22e">setHeader</span>(<span style="color:#e6db74">&#34;Cache-Control&#34;</span>, <span style="color:#e6db74">&#34;no-cache&#34;</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">res</span>.<span style="color:#a6e22e">setHeader</span>(<span style="color:#e6db74">&#34;Content-Type&#34;</span>, <span style="color:#e6db74">&#34;text/event-stream;&#34;</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">res</span>.<span style="color:#a6e22e">setHeader</span>(<span style="color:#e6db74">&#34;Connection&#34;</span>, <span style="color:#e6db74">&#34;keep-alive&#34;</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">res</span>.<span style="color:#a6e22e">setHeader</span>(<span style="color:#e6db74">&#34;X-Accel-Buffering&#34;</span>, <span style="color:#e6db74">&#34;no&#34;</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">res</span>.<span style="color:#a6e22e">flushHeaders</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">client</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">await</span> <span style="color:#a6e22e">fluvio</span>.<span style="color:#a6e22e">connect</span>();
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">consumer</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">await</span> <span style="color:#a6e22e">client</span>.<span style="color:#a6e22e">partitionConsumer</span>(<span style="color:#a6e22e">topic</span>, <span style="color:#a6e22e">PARTITION</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">await</span> <span style="color:#a6e22e">consumer</span>.<span style="color:#a6e22e">stream</span>(<span style="color:#a6e22e">Offset</span>.<span style="color:#a6e22e">FromEnd</span>(), <span style="color:#66d9ef">async</span> (<span style="color:#a6e22e">record</span>: <span style="color:#66d9ef">Record</span>) <span style="color:#f92672">=&gt;</span> {
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">eventData</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">record</span>.<span style="color:#a6e22e">valueString</span>();
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">responseMsg</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">`data: </span><span style="color:#e6db74">${</span><span style="color:#a6e22e">JSON</span>.<span style="color:#a6e22e">stringify</span>(<span style="color:#a6e22e">eventData</span>)<span style="color:#e6db74">}</span><span style="color:#960050;background-color:#1e0010">\</span><span style="color:#e6db74">n</span><span style="color:#960050;background-color:#1e0010">\</span><span style="color:#e6db74">n`</span>;
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">res</span>.<span style="color:#a6e22e">write</span>(<span style="color:#a6e22e">responseMsg</span>);
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">res</span>.<span style="color:#a6e22e">write</span>(<span style="color:#e6db74">&#34;\n\n&#34;</span>);
</span></span><span style="display:flex;"><span>    });
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">res</span>.<span style="color:#a6e22e">on</span>(<span style="color:#e6db74">&#34;close&#34;</span>, () <span style="color:#f92672">=&gt;</span> {
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">res</span>.<span style="color:#a6e22e">end</span>();
</span></span><span style="display:flex;"><span>    });
</span></span><span style="display:flex;"><span>  } <span style="color:#66d9ef">catch</span> (<span style="color:#a6e22e">error</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#a6e22e">error</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">res</span>.<span style="color:#a6e22e">status</span>(<span style="color:#ae81ff">500</span>).<span style="color:#a6e22e">json</span>({
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">error</span>: <span style="color:#66d9ef">error</span>,
</span></span><span style="display:flex;"><span>    });
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>});
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// To get all the stocks topics
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#a6e22e">app</span>.<span style="color:#66d9ef">get</span>(<span style="color:#e6db74">&#34;/list&#34;</span>, <span style="color:#66d9ef">async</span> (<span style="color:#a6e22e">_</span>, <span style="color:#a6e22e">res</span>) <span style="color:#f92672">=&gt;</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">try</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">await</span> <span style="color:#a6e22e">fluvio</span>.<span style="color:#a6e22e">connect</span>();
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">admin</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">await</span> <span style="color:#a6e22e">fluvio</span>.<span style="color:#a6e22e">admin</span>();
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">topicsStr</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">await</span> <span style="color:#a6e22e">admin</span>.<span style="color:#a6e22e">listTopic</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">topics</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">JSON</span>.<span style="color:#a6e22e">parse</span>(<span style="color:#a6e22e">topicsStr</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">payload</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">topics</span>.<span style="color:#a6e22e">map</span>((<span style="color:#a6e22e">topic</span>: <span style="color:#66d9ef">Topic</span>) <span style="color:#f92672">=&gt;</span> {
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">return</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">name</span>: <span style="color:#66d9ef">topic.name</span>,
</span></span><span style="display:flex;"><span>      };
</span></span><span style="display:flex;"><span>    });
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">res</span>.<span style="color:#a6e22e">json</span>(<span style="color:#a6e22e">payload</span>);
</span></span><span style="display:flex;"><span>  } <span style="color:#66d9ef">catch</span> (<span style="color:#a6e22e">error</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#a6e22e">error</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">res</span>.<span style="color:#a6e22e">status</span>(<span style="color:#ae81ff">500</span>).<span style="color:#a6e22e">json</span>({
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">error</span>: <span style="color:#66d9ef">error</span>,
</span></span><span style="display:flex;"><span>    });
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>});
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">app</span>.<span style="color:#a6e22e">listen</span>(<span style="color:#a6e22e">PORT</span>, () <span style="color:#f92672">=&gt;</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#e6db74">`Server running on http://localhost:</span><span style="color:#e6db74">${</span><span style="color:#a6e22e">PORT</span><span style="color:#e6db74">}</span><span style="color:#e6db74">/`</span>);
</span></span><span style="display:flex;"><span>});
</span></span></code></pre></div><p>It is a very basic express API server with mainly <strong>3 endpoints</strong>:</p>
<ol>
<li>
<p><code>/list</code>: To get the list of topics from fluvio. Topics are like a river with flowing data. In our case, we will have topics for stocks like
<code>amzn</code>- Amazon
<code>msft</code> - Microsoft, etc
We will name topics with stock symbols of the company that will help as you see more in the project.</p>
</li>
<li>
<p><code>/price</code>: This endpoint is for fluvio here we have the stock symbol default to <code>appl</code> it can be changed with the query <code>?symbol=[STOCK]</code>. We are fetching the price from <code>yahoo-finance2</code> package.</p>
</li>
<li>
<p><code>/stream/:topic</code>: This endpoint is very important because it uses a server-side event stream to distribute real-time data from fluvio to client apps.</p>
</li>
</ol>
<h2 id="step-4-create-a-nextjs-app">Step 4: Create a next.js app</h2>
<p>Comeon We all know how to create a next.js project do this yourself you are a dev! make a project with typescript, tailwindcss, and app dir.</p>
<ul>
<li>Install required dependencies:</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>bun add moment recharts
</span></span></code></pre></div><ul>
<li>Now create a folder named <code>components</code> and add <strong>2 files</strong>&quot;</li>
</ul>
<ol>
<li>StockChart.tsx</li>
<li>StockSwitch.tsx</li>
</ol>
<h2 id="stockcharttsx">StockChart.tsx</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-tsx" data-lang="tsx"><span style="display:flex;"><span><span style="color:#e6db74">&#34;use client&#34;</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">import</span> { <span style="color:#a6e22e">useEffect</span>, <span style="color:#a6e22e">useState</span> } <span style="color:#66d9ef">from</span> <span style="color:#e6db74">&#34;react&#34;</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">import</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">LineChart</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">Line</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">CartesianGrid</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">XAxis</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">YAxis</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">Tooltip</span>,
</span></span><span style="display:flex;"><span>} <span style="color:#66d9ef">from</span> <span style="color:#e6db74">&#34;recharts&#34;</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">import</span> <span style="color:#a6e22e">moment</span> <span style="color:#66d9ef">from</span> <span style="color:#e6db74">&#34;moment&#34;</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">import</span> { <span style="color:#a6e22e">useSearchParams</span> } <span style="color:#66d9ef">from</span> <span style="color:#e6db74">&#34;next/navigation&#34;</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">StockData</span> <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">symbol</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">string</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">price</span>: <span style="color:#66d9ef">number</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">time</span>: <span style="color:#66d9ef">string</span>;
</span></span><span style="display:flex;"><span>};
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">StockChart</span> <span style="color:#f92672">=</span> () <span style="color:#f92672">=&gt;</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">searchParams</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">useSearchParams</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#66d9ef">symbol</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">searchParams</span>.<span style="color:#66d9ef">get</span>(<span style="color:#e6db74">&#34;symbol&#34;</span>) <span style="color:#f92672">??</span> <span style="color:#e6db74">&#34;appl&#34;</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> [<span style="color:#a6e22e">chartData</span>, <span style="color:#a6e22e">setChartData</span>] <span style="color:#f92672">=</span> <span style="color:#a6e22e">useState</span>&lt;<span style="color:#f92672">StockData</span><span style="color:#960050;background-color:#1e0010">[]</span>&gt;([]);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">TOPIC_NAME</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">symbol</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">useEffect</span>(() <span style="color:#f92672">=&gt;</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">sse</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">EventSource</span>(<span style="color:#e6db74">`http://localhost:8080/stream/</span><span style="color:#e6db74">${</span><span style="color:#a6e22e">TOPIC_NAME</span><span style="color:#e6db74">}</span><span style="color:#e6db74">`</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">sse</span>.<span style="color:#a6e22e">onmessage</span> <span style="color:#f92672">=</span> (<span style="color:#a6e22e">event</span>) <span style="color:#f92672">=&gt;</span> {
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">try</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">preParsedData</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">JSON</span>.<span style="color:#a6e22e">parse</span>(<span style="color:#a6e22e">event</span>.<span style="color:#a6e22e">data</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">parsedData</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">JSON</span>.<span style="color:#a6e22e">parse</span>(<span style="color:#a6e22e">preParsedData</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">setChartData</span>((<span style="color:#a6e22e">prevData</span>) <span style="color:#f92672">=&gt;</span> [
</span></span><span style="display:flex;"><span>          ...<span style="color:#a6e22e">prevData</span>,
</span></span><span style="display:flex;"><span>          {
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">price</span>: <span style="color:#66d9ef">parsedData.price</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">symbol</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">parsedData</span>.<span style="color:#66d9ef">symbol</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">time</span>: <span style="color:#66d9ef">moment</span>(<span style="color:#66d9ef">new</span> Date(<span style="color:#a6e22e">parsedData</span>.<span style="color:#a6e22e">time</span>)).<span style="color:#a6e22e">format</span>(<span style="color:#e6db74">&#34;hh:mm:ss A&#34;</span>),
</span></span><span style="display:flex;"><span>          },
</span></span><span style="display:flex;"><span>        ]);
</span></span><span style="display:flex;"><span>      } <span style="color:#66d9ef">catch</span> (<span style="color:#a6e22e">error</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#e6db74">&#34;Error parsing SSE data:&#34;</span>, <span style="color:#a6e22e">error</span>);
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>    };
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> () <span style="color:#f92672">=&gt;</span> {
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">sse</span>.<span style="color:#a6e22e">close</span>();
</span></span><span style="display:flex;"><span>    };
</span></span><span style="display:flex;"><span>  }, [<span style="color:#a6e22e">TOPIC_NAME</span>]);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">formatYAxis</span> <span style="color:#f92672">=</span> (<span style="color:#a6e22e">price</span>: <span style="color:#66d9ef">number</span>) <span style="color:#f92672">=&gt;</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#e6db74">`$</span><span style="color:#e6db74">${</span><span style="color:#a6e22e">price</span>.<span style="color:#a6e22e">toFixed</span>(<span style="color:#ae81ff">0</span>)<span style="color:#e6db74">}</span><span style="color:#e6db74">`</span>;
</span></span><span style="display:flex;"><span>  };
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span> (
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#f92672">div</span>&gt;
</span></span><span style="display:flex;"><span>      &lt;<span style="color:#f92672">h1</span> <span style="color:#a6e22e">className</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;font-semibold text-xl&#34;</span>&gt;
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">Real</span><span style="color:#f92672">-</span><span style="color:#a6e22e">time</span> {<span style="color:#66d9ef">symbol</span>.<span style="color:#a6e22e">toUpperCase</span>()} <span style="color:#a6e22e">Stock</span> <span style="color:#a6e22e">Prices</span>
</span></span><span style="display:flex;"><span>      &lt;/<span style="color:#f92672">h1</span>&gt;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      &lt;<span style="color:#f92672">LineChart</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">width</span><span style="color:#f92672">=</span>{<span style="color:#ae81ff">820</span>}
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">height</span><span style="color:#f92672">=</span>{<span style="color:#ae81ff">400</span>}
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">data</span><span style="color:#f92672">=</span>{<span style="color:#a6e22e">chartData</span>}
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">margin</span><span style="color:#f92672">=</span>{{ <span style="color:#a6e22e">top</span>: <span style="color:#66d9ef">20</span>, <span style="color:#a6e22e">right</span>: <span style="color:#66d9ef">30</span>, <span style="color:#a6e22e">bottom</span>: <span style="color:#66d9ef">10</span>, <span style="color:#a6e22e">left</span>: <span style="color:#66d9ef">10</span> }}
</span></span><span style="display:flex;"><span>      &gt;
</span></span><span style="display:flex;"><span>        &lt;<span style="color:#f92672">CartesianGrid</span> <span style="color:#a6e22e">stroke</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;#f5f5f5&#34;</span> /&gt;
</span></span><span style="display:flex;"><span>        &lt;<span style="color:#f92672">XAxis</span> <span style="color:#a6e22e">dataKey</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;time&#34;</span> /&gt;
</span></span><span style="display:flex;"><span>        &lt;<span style="color:#f92672">YAxis</span> <span style="color:#a6e22e">tickFormatter</span><span style="color:#f92672">=</span>{<span style="color:#a6e22e">formatYAxis</span>} /&gt;
</span></span><span style="display:flex;"><span>        &lt;<span style="color:#f92672">Tooltip</span> /&gt;
</span></span><span style="display:flex;"><span>        &lt;<span style="color:#f92672">Line</span> <span style="color:#a6e22e">type</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;monotone&#34;</span> <span style="color:#a6e22e">dataKey</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;price&#34;</span> <span style="color:#a6e22e">stroke</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;#8884d8&#34;</span> /&gt;
</span></span><span style="display:flex;"><span>      &lt;/<span style="color:#f92672">LineChart</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;/<span style="color:#f92672">div</span>&gt;
</span></span><span style="display:flex;"><span>  );
</span></span><span style="display:flex;"><span>};
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">export</span> <span style="color:#66d9ef">default</span> <span style="color:#a6e22e">StockChart</span>;
</span></span></code></pre></div><p>This component is a client-side component that fetches real-time events from the express API server we created. You can analyse the code It has a very simple Chart with Price and time. One State to set stock data and get a stock symbol from search params.</p>
<h2 id="stockswitchtsx">StockSwitch.tsx</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-tsx" data-lang="tsx"><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">import</span> <span style="color:#a6e22e">Link</span> <span style="color:#66d9ef">from</span> <span style="color:#e6db74">&#34;next/link&#34;</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">import</span> <span style="color:#a6e22e">React</span> <span style="color:#66d9ef">from</span> <span style="color:#e6db74">&#34;react&#34;</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">Stock</span> <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">name</span>: <span style="color:#66d9ef">string</span>;
</span></span><span style="display:flex;"><span>};
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">fetchlist</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">async</span> () <span style="color:#f92672">=&gt;</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">res</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">await</span> <span style="color:#a6e22e">fetch</span>(<span style="color:#e6db74">&#34;http://localhost:8080/list&#34;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">data</span>: <span style="color:#66d9ef">Stock</span>[] <span style="color:#f92672">=</span> <span style="color:#66d9ef">await</span> <span style="color:#a6e22e">res</span>.<span style="color:#a6e22e">json</span>();
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">res</span>.<span style="color:#a6e22e">ok</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">data</span>;
</span></span><span style="display:flex;"><span>  } <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> [];
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>};
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">export</span> <span style="color:#66d9ef">default</span> <span style="color:#66d9ef">async</span> <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">StockSwitch() {</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">stocks</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">await</span> <span style="color:#a6e22e">fetchlist</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span> (
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#f92672">div</span>&gt;
</span></span><span style="display:flex;"><span>      &lt;<span style="color:#f92672">ul</span>&gt;
</span></span><span style="display:flex;"><span>        {<span style="color:#a6e22e">stocks</span>.<span style="color:#a6e22e">map</span>((<span style="color:#a6e22e">stock</span>) <span style="color:#f92672">=&gt;</span> (
</span></span><span style="display:flex;"><span>          &lt;<span style="color:#f92672">li</span>&gt;
</span></span><span style="display:flex;"><span>            &lt;<span style="color:#f92672">Link</span>
</span></span><span style="display:flex;"><span>              <span style="color:#a6e22e">href</span><span style="color:#f92672">=</span>{<span style="color:#e6db74">`?symbol=</span><span style="color:#e6db74">${</span><span style="color:#a6e22e">stock</span>.<span style="color:#a6e22e">name</span><span style="color:#e6db74">}</span><span style="color:#e6db74">`</span>}
</span></span><span style="display:flex;"><span>              <span style="color:#a6e22e">className</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;text-blue-500 font-semibold hover:underline&#34;</span>
</span></span><span style="display:flex;"><span>            &gt;
</span></span><span style="display:flex;"><span>              {<span style="color:#a6e22e">stock</span>.<span style="color:#a6e22e">name</span>}
</span></span><span style="display:flex;"><span>            &lt;/<span style="color:#f92672">Link</span>&gt;
</span></span><span style="display:flex;"><span>          &lt;/<span style="color:#f92672">li</span>&gt;
</span></span><span style="display:flex;"><span>        ))}
</span></span><span style="display:flex;"><span>      &lt;/<span style="color:#f92672">ul</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;/<span style="color:#f92672">div</span>&gt;
</span></span><span style="display:flex;"><span>  );
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>A very simple component fetches data and populates the topics from fluvio using our express server API.</p>
<h2 id="now-link-all-the-parts-in-pagetsx">Now link all the parts in <code>page.tsx</code></h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-tsx" data-lang="tsx"><span style="display:flex;"><span><span style="color:#66d9ef">import</span> <span style="color:#a6e22e">StockChart</span> <span style="color:#66d9ef">from</span> <span style="color:#e6db74">&#34;@/components/StockChart&#34;</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">import</span> <span style="color:#a6e22e">StockSwitch</span> <span style="color:#66d9ef">from</span> <span style="color:#e6db74">&#34;@/components/StockSwitch&#34;</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">import</span> <span style="color:#a6e22e">Link</span> <span style="color:#66d9ef">from</span> <span style="color:#e6db74">&#34;next/link&#34;</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">export</span> <span style="color:#66d9ef">default</span> <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">Home() {</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span> (
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#f92672">div</span> <span style="color:#a6e22e">className</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;flex p-2 flex-col justify-center h-screen items-center&#34;</span>&gt;
</span></span><span style="display:flex;"><span>      &lt;<span style="color:#f92672">main</span>&gt;
</span></span><span style="display:flex;"><span>        &lt;<span style="color:#f92672">h1</span>&gt;<span style="color:#a6e22e">Welcome</span> <span style="color:#a6e22e">to</span> <span style="color:#a6e22e">the</span> <span style="color:#a6e22e">Stock</span> <span style="color:#a6e22e">Charts</span>&lt;/<span style="color:#f92672">h1</span>&gt;
</span></span><span style="display:flex;"><span>        &lt;<span style="color:#f92672">StockChart</span> /&gt;
</span></span><span style="display:flex;"><span>        &lt;<span style="color:#f92672">div</span> <span style="color:#a6e22e">className</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;mt-4&#34;</span>&gt;
</span></span><span style="display:flex;"><span>          &lt;<span style="color:#f92672">p</span> <span style="color:#a6e22e">className</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;text-lg font-medium text-gray-700&#34;</span>&gt;<span style="color:#a6e22e">Other</span> <span style="color:#a6e22e">Stocks</span>&lt;/<span style="color:#f92672">p</span>&gt;
</span></span><span style="display:flex;"><span>          &lt;<span style="color:#f92672">StockSwitch</span> /&gt;
</span></span><span style="display:flex;"><span>        &lt;/<span style="color:#f92672">div</span>&gt;
</span></span><span style="display:flex;"><span>      &lt;/<span style="color:#f92672">main</span>&gt;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      &lt;<span style="color:#f92672">footer</span>&gt;
</span></span><span style="display:flex;"><span>        &lt;<span style="color:#f92672">p</span>&gt;
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">Powered</span> <span style="color:#a6e22e">by</span>{<span style="color:#e6db74">&#34; &#34;</span>}
</span></span><span style="display:flex;"><span>          &lt;<span style="color:#f92672">Link</span> <span style="color:#a6e22e">className</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;text-blue-500&#34;</span> <span style="color:#a6e22e">href</span><span style="color:#f92672">=</span>{<span style="color:#e6db74">&#34;https://www.fluvio.io&#34;</span>}&gt;
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">Fluvio</span>
</span></span><span style="display:flex;"><span>          &lt;/<span style="color:#f92672">Link</span>&gt;{<span style="color:#e6db74">&#34; &#34;</span>}
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">Realtime</span> <span style="color:#a6e22e">Data</span> <span style="color:#a6e22e">flow</span>.
</span></span><span style="display:flex;"><span>        &lt;/<span style="color:#f92672">p</span>&gt;
</span></span><span style="display:flex;"><span>      &lt;/<span style="color:#f92672">footer</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;/<span style="color:#f92672">div</span>&gt;
</span></span><span style="display:flex;"><span>  );
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h2 id="step-5-real-magic-of-fluvio">Step 5: Real magic of Fluvio!</h2>
<ul>
<li>Create a folder named <code>http-sources</code> as shown in the project structure.</li>
<li>Create <code>[STOCKNAME].yml</code> files for stock prices</li>
<li>Creating one for appl:</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yml" data-lang="yml"><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">0.1.0</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">meta</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">version</span>: <span style="color:#ae81ff">0.2.5</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">stock-appl</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">type</span>: <span style="color:#ae81ff">http-source</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">topic</span>: <span style="color:#ae81ff">appl</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">http</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">endpoint</span>: <span style="color:#e6db74">&#34;http://localhost:8080/price?symbol=APPL&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">method</span>: <span style="color:#ae81ff">GET</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">interval</span>: <span style="color:#ae81ff">3s</span>
</span></span></code></pre></div><p>In this file, we are using a source connector <code>http-source</code> and pulling data from our express API server. With <code>GET</code> method with <code>3s</code> interval.</p>
<p>You can add more stocks like this with just [STOCKNAME] change (example.yml):</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yml" data-lang="yml"><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">0.1.0</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">meta</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">version</span>: <span style="color:#ae81ff">0.2.5</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">stock-{STOCKNAME}</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">type</span>: <span style="color:#ae81ff">http-source</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">topic</span>: {<span style="color:#ae81ff">STOCKNAME}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">http</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">endpoint</span>: <span style="color:#e6db74">&#34;http://localhost:8080/price?symbol={STOCKNAME}&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">method</span>: <span style="color:#ae81ff">GET</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">interval</span>: <span style="color:#ae81ff">3s</span>
</span></span></code></pre></div><h2 id="step-6-the-now-final-step-of-the-game">STEP 6: The now final step of the game</h2>
<ul>
<li>Inside <code>http-sources</code> folder run command:</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>cdk hub download infinyon/http-source@0.3.8
</span></span></code></pre></div><p>This will download the file required for fluvio <code>yml</code>.</p>
<ul>
<li>Create a topic in fluvio (remember topic name should be unique and should be the same as written in .yml file for me it is {STOCKNAME} or apply)</li>
</ul>
<p>Run command:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>fluvio topic create appl
</span></span></code></pre></div><ul>
<li>Lastly deploy the .yml file:
cdk deploy start &ndash;ipkg infinyon-http-source-0.3.8.ipkg -c appl.yml</li>
</ul>
<p><code>--ipkg</code> is the file downloaded from previous command
<code>-c</code> is the .yml file name.</p>
<p>To make your life more easier I wrote a <code>deploy.sh</code> file that will do this Slep 6 with one command:</p>
<p><code>deploy.sh</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span><span style="color:#75715e">#!/bin/bash
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Set variables</span>
</span></span><span style="display:flex;"><span>PACKAGE_NAME<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;infinyon-http-source-0.3.8&#34;</span>
</span></span><span style="display:flex;"><span>PACKAGE_VERSION<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;0.3.8&#34;</span>
</span></span><span style="display:flex;"><span>PACKAGE_IPKG<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">${</span>PACKAGE_NAME<span style="color:#e6db74">}</span><span style="color:#e6db74">.ipkg&#34;</span>
</span></span><span style="display:flex;"><span>PACKAGE_URL<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;infinyon/http-source@</span><span style="color:#e6db74">${</span>PACKAGE_VERSION<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>HTTP_SOURCES_DIR<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;.&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Function to download the package if it doesn&#39;t exist</span>
</span></span><span style="display:flex;"><span>download_package<span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">if</span> <span style="color:#f92672">[</span> ! -f <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">${</span>HTTP_SOURCES_DIR<span style="color:#e6db74">}</span><span style="color:#e6db74">/</span><span style="color:#e6db74">${</span>PACKAGE_IPKG<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span> <span style="color:#f92672">]</span>; <span style="color:#66d9ef">then</span>
</span></span><span style="display:flex;"><span>    echo <span style="color:#e6db74">&#34;Package </span><span style="color:#e6db74">${</span>PACKAGE_IPKG<span style="color:#e6db74">}</span><span style="color:#e6db74"> not found. Downloading...&#34;</span>
</span></span><span style="display:flex;"><span>    cdk hub download <span style="color:#e6db74">${</span>PACKAGE_URL<span style="color:#e6db74">}</span> -o <span style="color:#e6db74">${</span>HTTP_SOURCES_DIR<span style="color:#e6db74">}</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">else</span>
</span></span><span style="display:flex;"><span>    echo <span style="color:#e6db74">&#34;Package </span><span style="color:#e6db74">${</span>PACKAGE_IPKG<span style="color:#e6db74">}</span><span style="color:#e6db74"> already exists.&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">fi</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Function to deploy configurations</span>
</span></span><span style="display:flex;"><span>deploy_configurations<span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">for</span> file in <span style="color:#e6db74">${</span>HTTP_SOURCES_DIR<span style="color:#e6db74">}</span>/*.yml; <span style="color:#66d9ef">do</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> <span style="color:#f92672">[</span> -f <span style="color:#e6db74">&#34;</span>$file<span style="color:#e6db74">&#34;</span> <span style="color:#f92672">]</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#f92672">[</span> <span style="color:#e6db74">&#34;</span><span style="color:#66d9ef">$(</span>basename <span style="color:#e6db74">&#34;</span>$file<span style="color:#e6db74">&#34;</span><span style="color:#66d9ef">)</span><span style="color:#e6db74">&#34;</span> !<span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;example-source.yml&#34;</span> <span style="color:#f92672">]</span>; <span style="color:#66d9ef">then</span>
</span></span><span style="display:flex;"><span>      echo <span style="color:#e6db74">&#34;Deploying </span><span style="color:#e6db74">${</span>file<span style="color:#e6db74">}</span><span style="color:#e6db74">...&#34;</span>
</span></span><span style="display:flex;"><span>      echo <span style="color:#e6db74">&#34;Command: cdk deploy start --ipkg </span><span style="color:#e6db74">${</span>PACKAGE_IPKG<span style="color:#e6db74">}</span><span style="color:#e6db74"> -c </span><span style="color:#e6db74">${</span>file<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>      cdk deploy start --ipkg <span style="color:#e6db74">${</span>PACKAGE_IPKG<span style="color:#e6db74">}</span> -c <span style="color:#e6db74">${</span>file<span style="color:#e6db74">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">else</span>
</span></span><span style="display:flex;"><span>      echo <span style="color:#e6db74">&#34;Skipping </span><span style="color:#e6db74">${</span>file<span style="color:#e6db74">}</span><span style="color:#e6db74">.&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">fi</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">done</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Function to create Fluvio topics</span>
</span></span><span style="display:flex;"><span>create_topics<span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">for</span> file in <span style="color:#e6db74">${</span>HTTP_SOURCES_DIR<span style="color:#e6db74">}</span>/*.yml; <span style="color:#66d9ef">do</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> <span style="color:#f92672">[</span> -f <span style="color:#e6db74">&#34;</span>$file<span style="color:#e6db74">&#34;</span> <span style="color:#f92672">]</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#f92672">[</span> <span style="color:#e6db74">&#34;</span><span style="color:#66d9ef">$(</span>basename <span style="color:#e6db74">&#34;</span>$file<span style="color:#e6db74">&#34;</span><span style="color:#66d9ef">)</span><span style="color:#e6db74">&#34;</span> !<span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;example-source.yml&#34;</span> <span style="color:#f92672">]</span>; <span style="color:#66d9ef">then</span>
</span></span><span style="display:flex;"><span>      <span style="color:#75715e"># Extract the topic using sed</span>
</span></span><span style="display:flex;"><span>      topic<span style="color:#f92672">=</span><span style="color:#66d9ef">$(</span>sed -n <span style="color:#e6db74">&#39;s/^[[:space:]]*topic:[[:space:]]*\(.*\)/\1/p&#39;</span> <span style="color:#e6db74">&#34;</span>$file<span style="color:#e6db74">&#34;</span><span style="color:#66d9ef">)</span>
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">if</span> <span style="color:#f92672">[</span> -n <span style="color:#e6db74">&#34;</span>$topic<span style="color:#e6db74">&#34;</span> <span style="color:#f92672">]</span>; <span style="color:#66d9ef">then</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Check if the topic already exists</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> fluvio topic list | grep -q <span style="color:#e6db74">&#34;^</span><span style="color:#e6db74">${</span>topic<span style="color:#e6db74">}</span>$<span style="color:#e6db74">&#34;</span>; <span style="color:#66d9ef">then</span>
</span></span><span style="display:flex;"><span>          echo <span style="color:#e6db74">&#34;Topic </span><span style="color:#e6db74">${</span>topic<span style="color:#e6db74">}</span><span style="color:#e6db74"> already exists. Skipping creation.&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">else</span>
</span></span><span style="display:flex;"><span>          echo <span style="color:#e6db74">&#34;Creating Fluvio topic </span><span style="color:#e6db74">${</span>topic<span style="color:#e6db74">}</span><span style="color:#e6db74">...&#34;</span>
</span></span><span style="display:flex;"><span>          fluvio topic create <span style="color:#e6db74">${</span>topic<span style="color:#e6db74">}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">fi</span>
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">else</span>
</span></span><span style="display:flex;"><span>        echo <span style="color:#e6db74">&#34;No topic found in </span><span style="color:#e6db74">${</span>file<span style="color:#e6db74">}</span><span style="color:#e6db74">.&#34;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">fi</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">else</span>
</span></span><span style="display:flex;"><span>      echo <span style="color:#e6db74">&#34;Skipping </span><span style="color:#e6db74">${</span>file<span style="color:#e6db74">}</span><span style="color:#e6db74">.&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">fi</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">done</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Main script execution</span>
</span></span><span style="display:flex;"><span>download_package
</span></span><span style="display:flex;"><span>create_topics
</span></span><span style="display:flex;"><span>deploy_configurations
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>echo <span style="color:#e6db74">&#34;Script execution completed.&#34;</span>
</span></span></code></pre></div><p>Run Command:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>./deploy.sh
</span></span></code></pre></div><p>Now you are good to go.</p>
<h2 id="finishing-up">Finishing Up.</h2>
<p>Run <code>client</code> and <code>server</code></p>
<ul>
<li>go inside <code>/client</code> run <code>bun dev</code></li>
<li>go inside <code>/server</code> run <code>bun run index.ts</code></li>
</ul>
<p>Now open <code>https://localhost:3000</code> and see your application.</p>
<h1 id="things-can-extend">Things can extend</h1>
<ul>
<li>add more stocks</li>
<li>make a good UI</li>
<li>add authentication</li>
<li>&hellip;more.</li>
</ul>
<p>This was for this article
Source Repo: <a href="https://github.com/priyanshuverma-dev/stock-charts">https://github.com/priyanshuverma-dev/stock-charts</a></p>
<p>Thanks,
Priyanshu Verma</p>
</div>


        </div>
        
<div id="footer">
  <span class="post-meta">
    &copy; Priyanshu Verma &nbsp;2024
  </span>
  &nbsp;  
  <a
    href="/blog/sitemap.xml"
    title="Sitemap"
    target="_blank"
    >Sitemap</a> &nbsp; 
  <a
    href="https://github.com/priyanshuverma-dev"
    title="Github"
    target="_blank"
    >Github</a>
</div>

    </div>
    <div id="right-wrapper">
        

    </div>
</div>
</body>
</html>
